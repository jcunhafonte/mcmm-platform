<!DOCTYPE html>
<html>
<head>
    <title></title>

    <!--<link rel="stylesheet" href="styles/main.css">-->

</head>
<body>



<div class="clearfix">


    <div style="width: 680px; float: left; margin-bottom: 100px;">
        <div class="well " >
            <iframe src="http://www.ustream.tv/embed/22354809" id="UstreamFrame" width="640" height="392" style="border: 0 transparent none;"></iframe>
        </div>

        <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-content btn-info" type="button"><i class="icon-user"></i> Get Content</button>
                    </span>
            <input class="form-control span2" id="Content" readonly="readonly" type="text">
        </div>



    </div>

    <form class="form-inline" action="#">
        <fieldset style="margin: 0 20px; float: left; width: 200px;">


            <button class="btn btn-success control-play" type="button"><i class="icon-play"></i> Play</button>
            <button class="btn control-pause btn-info" type="button"><i class="icon-pause"></i> Pause</button>


            <hr />
            <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-seek btn-info" type="button"><i class="icon-forward"></i> Seek to</button>
                    </span>
                <input class="form-control span2" id="SeekTo" type="text">
            </div>
            <hr />
            <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-volume btn-info" type="button"><i class="icon-volume-up"></i> Set volume</button>
                    </span>
                <input class="form-control span2" value="100" id="SetVolume" type="number">
            </div>
            <hr />
            <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-duration btn-info" type="button"><i class="icon-time"></i> Get Duration</button>
                    </span>
                <input class="form-control span2" id="Duration" readonly="readonly"  type="text">
            </div>
            <hr />
            <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-progress btn-info" type="button"><i class="icon-map-marker"></i> Get Progress</button>
                    </span>
                <input class="form-control span2" id="Progress" readonly="readonly"  type="text">
            </div>
            <hr />
            <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn control-viewers btn-info" type="button"><i class="icon-user"></i> Get Viewers</button>
                    </span>
                <input class="form-control span2" id="Viewers" readonly="readonly" type="text">
            </div>
            <hr />
            <div class="input-group">
                <input class="span2 form-control"  type="number" placeholder="content id" id="LoadContent">
                <div class="input-group-btn">

                    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">Load <span class="caret"></span></button>


                    <ul class="dropdown-menu">
                        <li><a href="#" class="control-load-channel">channel</a></li>
                        <li><a href="#" class="control-load-video">video</a></li>

                    </ul>
                </div>
            </div>
            <hr />


            <div class="btn-group">
                <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
                    Quality
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu quality-selector">
                </ul>
            </div>

            <hr />



        </fieldset>
    </form>
</div>

<script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="bower_components/ustream-embedapi/pkg/ustream-embedapi.min.js"></script>
<script type="text/javascript" src="bower_components/sass-bootstrap/dist/js/bootstrap.min.js"></script>

<script type="text/javascript">

    $(document).ready(function () {

        var viewer = UstreamEmbed("UstreamFrame");

        $('.media').on("click", function (e) {
            clearFields();

            var target = $(e.currentTarget),
                    media = target.data('media'),
                    type = target.data('type');

            viewer.callMethod('load', type, media);

            e.preventDefault();
        });


        /*
         set up controls
         */
        $(document.body).on("click", '.btn, .dropdown-menu a', function (e) {
            var target = $(e.currentTarget),
                    control = target[0].className.match(/control-([a-zA-Z0-9\-]*)/);

            if (control && control[1]) {

                switch (control[1]) {

                    case "play":
                        viewer.callMethod('play');
                        break;
                    case "pause":
                        viewer.callMethod('pause');
                        break;
                    case "seek":
                        viewer.callMethod('seek', $("#SeekTo").val());
                        break;
                    case "volume":
                        viewer.callMethod('volume', $("#SetVolume").val());
                        break;
                    case "duration":
                        viewer.getProperty('duration', function (data) {
                            $('#Duration').val(data);
                        });
                        break;
                    case "progress":
                        viewer.getProperty('progress', function (data) {
                            $('#Progress').val(data);
                        });
                        break;
                    case "viewers":
                        viewer.getProperty('viewers', function (data) {
                            $('#Viewers').val(data);
                        });
                        break;
                    case "content":
                        viewer.getProperty('content', function (data) {
                            $('#Content').val(data.join(','));
                        });
                        break;
                    case "load-video":
                        clearFields();
                        viewer.callMethod('load', 'video', $("#LoadContent").val());
                        break;
                    case "load-channel":
                        clearFields();
                        viewer.callMethod('load', 'channel', $("#LoadContent").val());
                        break;
                    case "quality":
                        viewer.callMethod('quality', target.data('quality'));
                        break;

                }

            }

            e.preventDefault();
        });


        /*
         populate quality selector with receiced data
         */
        var populateQualitySelector = function (data) {
            var list =  $('.quality-selector');
            list.find('li').remove(); // remove previously set data
            for (var id in data) {
                list.append('<li><a href="#" class="control-quality" data-quality="' + id + '">' + data[id].label + '</a></li>')
            }
        }

        /*
         clear some data fields that are relevant to content
         */
        var clearFields = function () {
            populateQualitySelector({});
            $('#Progress').val('');
            $('#Viewers').val('');
            $('#Duration').val('');

            $('.st-ended').hide();
            $('.st-playing').hide();
            $('.st-offline').hide();
            $('.st-live').hide();
        }

        /*
         event handler for events received from the embed iframe
         */
        var onEmbedEvent = function (event, data) {
            console.log(event)
            switch (event) {
                case "ready":
                    clearFields();
                    break;
                case "quality":
                    populateQualitySelector(data);
                    break;
                case "live":
                    $('.st-live').show();
                    $('.st-offline').hide();
                    break;
                case "offline":
                    $('.st-offline').show();
                    $('.st-live').hide();
                    break;
                case "playing":
                    if (data) {
                        $('.st-playing').show()
                    } else {
                        $('.st-playing').hide();
                    }
                    break;
                case "finished":
                    $('.st-ended').show();
                    break;
                case "content":
                    $('.st-content').text(data.join(','));
                    break;
                case "size":
                    break;
            }
        }

        viewer.addListener('ready', onEmbedEvent);
        viewer.addListener('quality', onEmbedEvent);
        viewer.addListener('live', onEmbedEvent);
        viewer.addListener('offline', onEmbedEvent);
        viewer.addListener('playing', onEmbedEvent);
        viewer.addListener('finished', onEmbedEvent);
        viewer.addListener('size', onEmbedEvent);
        viewer.addListener('content', onEmbedEvent);

    });

</script>

</body>
</html>